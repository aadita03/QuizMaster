{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Upload New Quiz</h2>
    <form method="POST" id="quizForm">
        <div class="mb-3">
            <label class="form-label">Subject</label>
            <select class="form-select" name="subject_id" id="subjectSelect" required>
                <option value="">Select Subject</option>
                {% for subject in subjects %}
                <option value="{{ subject.id }}">{{ subject.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="mb-3">
            <label class="form-label">Chapter</label>
            <select class="form-select" name="chapter_id" id="chapterSelect" required disabled>
                <option value="">Select Chapter</option>
            </select>
        </div>
        
        <div class="mb-3">
            <label class="form-label">Time Duration (HH:MM)</label>
            <input type="text" class="form-control" name="time_duration" required>
        </div>
        
        <div id="questionsContainer">
            <!-- Questions will be added here dynamically -->
        </div>
        
        <button type="button" class="btn btn-secondary mb-3" id="addQuestion">Add Question</button>
        <input type="hidden" name="question_count" id="questionCount" value="0">
        <button type="submit" class="btn btn-primary">Upload Quiz</button>
    </form>
</div>

<script>
document.getElementById('subjectSelect').addEventListener('change', function() {
    const subjectId = this.value;
    const chapterSelect = document.getElementById('chapterSelect');
    
    if (subjectId) {
        fetch(`/admin/get-chapters/${subjectId}`)
            .then(response => response.json())
            .then(data => {
                chapterSelect.innerHTML = '<option value="">Select Chapter</option>';
                data.chapters.forEach(chapter => {
                    const option = document.createElement('option');
                    option.value = chapter.id;
                    option.textContent = chapter.name;
                    chapterSelect.appendChild(option);
                });
                chapterSelect.disabled = false;
            });
    } else {
        chapterSelect.innerHTML = '<option value="">Select Chapter</option>';
        chapterSelect.disabled = true;
    }
});

let questionCount = 0;
document.getElementById('addQuestion').addEventListener('click', function() {
    questionCount++;
    document.getElementById('questionCount').value = questionCount;
    
    const container = document.getElementById('questionsContainer');
    const questionDiv = document.createElement('div');
    questionDiv.className = 'card mb-3';
    questionDiv.innerHTML = `
        <div class="card-header">Question ${questionCount}</div>
        <div class="card-body">
            <div class="mb-3">
                <label class="form-label">Question</label>
                <input type="text" class="form-control" name="question_${questionCount}" required>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <input type="text" class="form-control mb-2" name="option1_${questionCount}" placeholder="Option 1" required>
                </div>
                <div class="col-md-6">
                    <input type="text" class="form-control mb-2" name="option2_${questionCount}" placeholder="Option 2" required>
                </div>
                <div class="col-md-6">
                    <input type="text" class="form-control mb-2" name="option3_${questionCount}" placeholder="Option 3" required>
                </div>
                <div class="col-md-6">
                    <input type="text" class="form-control mb-2" name="option4_${questionCount}" placeholder="Option 4" required>
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">Correct Option</label>
                <select class="form-select" name="correct_${questionCount}" required>
                    <option value="">Select Correct Option</option>
                    <option value="1">Option 1</option>
                    <option value="2">Option 2</option>
                    <option value="3">Option 3</option>
                    <option value="4">Option 4</option>
                </select>
            </div>
        </div>
    `;
    container.appendChild(questionDiv);
});
</script>
{% endblock %}